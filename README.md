# 高可用性系统

这是一个基于Go和Gin框架实现的高可用系统，具有完善的重试机制和外部监控集成。

## 系统特点

- **高可用架构**：采用多实例部署，支持水平扩展
- **完善的重试机制**：对外部服务调用自动重试，支持指数退避策略
- **第三方监控集成**：支持Prometheus监控系统
- **监控容错**：在监控系统失效时仍能正常运行，并进行本地日志记录
- **基于Gin框架**：高性能的Web框架

## 系统架构

```
+----------------+    +------------------+    +-------------------+
|                |    |                  |    |                   |
|  API客户端请求  +--->+  Gin Web服务     +--->+  业务服务层       |
|                |    |  (带重试中间件)   |    |                   |
+----------------+    +------------------+    +-------------------+
                                |                       |
                                v                       v
                      +------------------+    +-------------------+
                      |                  |    |                   |
                      |  监控系统集成     |    |  数据持久层        |
                      |  (带容错机制)     |    |                   |
                      +------------------+    +-------------------+
                                |
                                v
                      +------------------+
                      |                  |
                      |  第三方监控平台   |
                      |  (如Prometheus)  |
                      +------------------+
```

## 组件说明

1. **重试机制** (`pkg/retry`): 提供可配置的重试策略，包括最大重试次数、重试间隔和退避策略
2. **健康检查** (`pkg/healthcheck`): 提供系统自检和依赖服务健康检查
3. **监控集成** (`internal/monitors`): 集成第三方监控系统，支持监控系统失效的容错处理
4. **API处理** (`internal/api`): 基于Gin的RESTful API实现
5. **中间件** (`internal/middleware`): 请求日志、重试、监控等中间件

## 如何运行

```bash
# 克隆仓库
git clone https://github.com/yourusername/high-availability-system.git

# 进入项目目录
cd high-availability-system

# 运行服务
go run cmd/api/main.go
```

## 配置文件

配置文件位于 `configs/config.yaml`，可设置以下内容：

- 服务端口
- 重试策略
- 监控系统集成
- 日志级别
- 数据库连接

## 监控与告警

系统内置Prometheus指标导出，可使用Grafana进行可视化和告警设置。默认指标端点为 `/metrics`。

## 高可用部署

推荐使用Kubernetes进行部署，示例配置文件位于 `deploy/` 目录中。 